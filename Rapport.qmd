---
title: "Effekter av arealbruk og arealbruksendringer på biodiversitet, økosystemtjenester og karbonlagrin i Norge: Et systematisk kart og beslutningsstøtteverktøy"
format:
  html:
    toc: true
params:
  version: "0.1"
  search-results: 36418
editor: visual
---

## 

Version: `r params$version`

# 1. Innledning

Endring i arealbruk og landdekke (LULCC) anses å være den dominerende driveren av nylig tap av biodiversitet både globalt og i Norge, og påvirker direkte naturens evne til å tilby naturgoder og -tjenester (Díaz et al., 2019; Malhi et al., 2020).
LULCC påvirker også et økosystems evne til å lagre og binde karbon i jord og biologisk materiale, og påvirker dermed direkte et økosystems evne til å bidra til å motvirke og tilpasse seg klimaendringer. Å kvantifisere, forstå og formidle dynamikken i arealendringer og deres effekter på biodiversitet, økosystemtjenester og karbonlagring er derfor en forutsetning for evidensbaserte arealbruksstrategier.
Imidlertid mangler det for øyeblikket systematisk evidens om dette temaet fra norske økosystemer. Mye av den offentlige diskursen på nasjonalt nivå domineres av internasjonale globale kunnskapssammendrag, til tross for betydelig usikkerhet rundt nedskalering og overføring av kunnskap fra globale og regionale synteser til lokalt/nasjonalt nivå, på tvers av økosystemer og taksonomiske grupper. Tidligere kunnskapssammendrag basert på data fra norske økosystemer har enten fulgt spesifikke tilnærminger (f.eks. Økosystemvurdering; (Nybø et al., 2017)), i stor grad basert på ekspertvurderinger (Artsdatabanken, 2021), eller vært begrenset i omfang. Mangelen på en omfattende oversikt over forskningsbasert kunnskap fra norske økosystemer fører også til at ulike interessegrupper og sektorer stoler på ulike "fakta," noe som ofte fører til eskalerende konflikter og dårlige beslutninger. Det er derfor et presserende behov både for en oppsummering av kunnskap og identifisering av reelle kunnskapshull.


Politikk og beslutningstaking knyttet til arealbruk og dens effekter på biodiversitet og klima er for øyeblikket blant de mest konfliktfylte og heftig debatterte politiske spørsmålene i Norge. Konfliktene involverer typisk dilemmaer mellom ulike samfunnsmessige bekymringer og interesser støttet av ulike sektorer og aktørgrupper (Guldbrandsen & Handberg, 2022; Skogen et al., 2021). Kunnskapskontrovers er også ofte en sentral egenskap ved konfliktene, og innebærer uenighet om kunnskapens status og motstridende kunnskapskrav om de miljømessige effektene av ulike alternativer for arealbruk (Aspøy & Stokland, 2022; Rusch et al., 2022). IPBES (2019, 2022a, 2022b) og IPCC (2018) har foreslått styringsmetoder og tiltak, slik som de knyttet til transformasjonsendringer og transformasjonsstyring, for å muliggjøre oppnåelsen av SDG-ene, grensen på 1,5°C og 2050-visjonen for biodiversitet. Slike tilnærminger involverer forbedret integrasjon og samhandling mellom samfunnsmessige mål, styringssektorer og flere kunnskapskilder, og er dermed svært relevante for norsk politikk og beslutningstaking knyttet til arealbruk. Imidlertid hindres utnyttelsen og tilpasningen av internasjonalt anbefalte tilnærminger og verktøy i en norsk kontekst for øyeblikket av mangelen på en omfattende forståelse av nasjonale og lokale dilemmaer og konflikter knyttet til arealbruk, samt de for tiden anvendte verktøyene og tilnærmingene. Det er derfor et presserende behov for en kunnskapssyntese og identifisering av kunnskapshull angående disse aspektene ved arealbruk og dens effekter på biodiversitet og klima.

Systematiske kart (også kjent som Evidenshullkart eller Evidenskart) ble designet for å gi en oversikt over tilgjengelig evidens om et bredt tema (Saran et al., 2020). De søker ikke å svare på smale, veldefinerte spørsmål (slik systematiske oversikter gjør), men heller å gi et middel til å identifisere og katalogisere tilgjengelig evidens om politisk relevante spørsmål (James et al., 2016). Systematiske kart har blitt realisert på en rekke ulike måter, men gir generelt resultatene på en brukervennlig måte, for eksempel ved hjelp av grafer, kart eller søkbare databaser (Miake-Lye et al., 2016). Interaktive plott og kartlegging blir i økende grad brukt for å gi en dynamisk utgang til brukerne (slik som EviAtlas; Haddaway et al., 2019). Det er viktig at systematiske kart ikke fremstilles som et mål i seg selv. Uten ytterligere evidenssyntese må beslutningstakere være forsiktige med å treffe beslutninger basert kun på evidensens vekt alene (dvs. stemmeoptelling, jf. (Hedges & Olkin, 1980)). Systematiske kart kan ikke erstatte rigoriteten til systematiske oversikter, men kan gi beslutningstakere forståelse av evidensgrunnlaget ved å belyse hull eller klynger av evidens. De kan vise hvor evidenssyntese kan finne sted (dvs. det er tilstrekkelig med tilgjengelig evidens for en systematisk oversikt) eller hvor primærforskning er nødvendig (dvs. det er mangel på evidens). Beslutningsmodeller kan supplere resultatene av en systematisk evidenssyntese for å plassere den tilgjengelige evidensen i beslutningskonteksten (Carrick et al., 2019).

## 1.1 Arealbruk og arealbruksendringer i Norge 

TROND OG/ELLER ANDERS - KAN DERE SKRIVE HER OM AREALBRUK OG AREALBRUKSENDRINGER I NORGE DEN SISTE TIDEN (LITT USIKKER PÅ TIDSPERSPEKTIV, MEN TROLIG SISTE 100-50 ÅR).

## 1.2 Involvering av brukere og samfunnsaktører

The outline for the review was presented at a conference held by the Norwegian Environment Agency and the Norwegian Research Council October 23, 2022. A general stakeholder meeting was arranged by NINA on April 25, 2023. The focus and scope of the review was narrowed and better defined during a specific stakeholder event on #date. Details of this meeting and the modifications in scope are available on request. Stakeholders who attended this event were invited to comment on the draft protocol prior to submission for publication. Stakeholders were not engaged during the conduct of the review.

## 1.3 Objective of the map

Hovedmålet med dette prosjektet er å gi en helhetlig oversikt over tilgjengelig kunnskap knyttet til effekter av arealbruk og arealbruksendringer på norsk natur, med fokus på biologisk mangfold, økosystemtjenester, klimatilpasning, karbonbinding og lagring. Kartet er begrenset i geografisk omfang til Norge, Sverige og Finland (se inklusjonskriterier nedenfor). Rapporten er dessuten ledsaget av et beslutningsstøtteverktøy som en utvidelse av det systematiske kartet for å kontekstualisere tilgjengelig kunnskap. Verktøyet er utformet som en konseptuell modell av kunnskapsfeltet og synliggjøre betydningen av kunnskapshull på ulike områder.

### 1.3.1 Hovedproblemstilling 

Hovedspørsmålet i vårt systematiske kart er «Hvilke forskningsbasert kunnskap finnes knyttet til virkningene av arealbruk og endringer i arealbruk på biologisk mangfold, økosystemtjenester og karbonbinding i Norge, hvilken type konflikter er identifisert mellom ulike former for arealbruk, og hvilke verktøy foreslås for å forbedre styringen".

### 1.3.2 Underproblemstillinger 

In addition, we will investigate what characterizes the existing body of literature on the topic, in terms of:

-   What proportion of the research is based on empirical data

-   What proportion of the research is based on experimental vs observational

-   What proportion of the research is based on qualitative vs quantitative/mixed

-   How is research spread across the major ecosystem types/realms

-   How is research spread across the disciplines

-   How is research spread across level of biological organization (species, taxa, ecosystem or services)

-   What are the dominant types of land use that are investigated?

-   What regions (in Norway) are most represented

-   What proportion of the research focuses on governance, conflicts and tools?

-   What are the dominant/marginal social scientific analytical approaches of the studies?

-   What type of actors are most represented in the studies?

-   Which sectors and societal concerns are most studied?

-   Which level of societal scale do the studies represent?

-   Which land use conflicts are most researched?

-   Which tools are proposed and investigated?

# 2 Metoder

Før prosjektet ble gjennomført ble det uviklet en detaljert protokoll som beskriver gjennomføringen, inkludert... \[Erlend skriver her\]

## 2.1 Avvik fra protokollen

Erlend skriver her...

## 2.2 Søk etter litteratur 

### 2.2.1 Søk i online databaser

Systematiske litteratursøk for akademisk (forskningsbasert) litteratur ble gjennomført i Scopus og i følgende Web of Science Core Collection databaser:

-   Science Citation Index Expanded (SCI-EXPANDED): 1987–dd.

-   Social Sciences Citation Index (SSCI): 1987–dd.

-   Arts and Humanities Citation Index (AHCI): 1987–dd.

-   Emerging Sources Citation Index (ESCI): 2015–dd.

Det ble gjennomført en rekke preliminære søk i Web of Science, og disse ble benyttet til å fintune søkestrengen (se [the protocol](https://osf.io/4ad3x)).

### 2.2.2 Søketermer og søkestreng 

I vår søkestrategi benyttet vi oss av PICO-rammeverket (James et al., 2016) for å strukturere søket, og sørge for at det var dekkende for vårt primære forskningsspørsmål.

Følgende søkestreng ble benyttet i WoS (tilsvarende streng ble benyttet i Scopus, men her ble søket justert for å passe systemets interface):

<!--# Add link to search strings -->

*TS=("land use" OR "land cover" OR "space use" OR LULCC OR (planning AND (spati\* OR region\* OR area\* OR conservation OR land\* OR urban)) OR (conversion AND (land\* OR habitat\* OR area\* OR ecosystem\* OR natur)) OR (change NEAR/3 (land\* OR area)) OR "national park" OR landscape\* OR habitat\* OR Husbandry OR "land shar" OR "land spar" OR (Outdoor NEAR/3 (life OR livin\* OR recreat)) OR (restoration AND (nature OR ecosystem)) OR forestry OR (reindeer NEAR/3 (herd\* OR husbandr)) OR (livestock NEAR/3 graz) OR "holiday home" OR "secondary home"OR (recreation\* NEAR/3 (home\* OR cottage\* OR cabin\* OR propert)) OR tourism OR "wind power" OR "Land manag" OR "Nature conservation" OR ((governance OR management) AND (spati\* OR region\* OR area\* OR conservation OR land\* OR urban)) OR aquaculture OR "fish farm" OR hydropower OR “green energy” OR “energy development” OR herding OR agriculture OR transportation OR road OR “oil and gas” OR petroleum OR mining OR windpower OR traffic OR road\* OR railway\* OR “hydroelectric power” OR “solar power” OR “solar electricity” OR “power plant” OR LULC OR LULUCF OR AFOLU OR FOLU)*

*AND*

*TS=(sustainab\* OR biodiversity OR "Ecosystem service" OR (carbon NEAR/3 (stor OR sequest)) OR (ecosystem NEAR/3 (impact\* OR effect\* OR provision\* OR regulat\* OR support\* OR cultur)) OR ((loss OR shrink OR bisection\* OR perforation OR fragmentation) AND (habitat OR land)) OR (climate NEAR/3 adapt) OR ecodiversity OR "ecosystem type" OR "ecological process" OR anthropogenic OR conflict OR (diversity NEAR/3 (ecological OR speci\* OR population\*)) OR red-list OR "water purification" OR "soil retention" OR spiritual OR cultural OR aesthetics OR "climate mitigation")*

We screened all systematic reviews and systematic maps from the international literature, the two categories were combined with TS=("Systematic review*" OR "systematic map*" OR "rapid review\*"). For the primary literature, the two categories were combined with TS=(Norway OR Norwegian OR Sweden OR Swedish OR Finland OR Finnish), and all results screened.

### 2.2.3 Språk 

Artikler skrevet på engelsk, norsk, svensk eller dansk ble inkludert i litteraturgjennomgangen. Studier skrevet på andre språk ble ikke inkludert.

### 2.2.4  Test av søkets omfang og dekning 

For å sørge for at søket ga en god dekning av den aktuelle litteraturen valgte vi ut 15 benchmark-artikler, og undersøkte hvor godt disse ble fanget opp av søket. Artiklene ble valgt ut gjennom en diskusjon i prosjektgruppa, med det formål å dekke både bredde og dybde i søket. I det enedelig søket ble totalt 13 av de 15 artiklene fanget opp.

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-cap: "Overlap between the different sources of literature and the benchmark papers"

library(CiteSource)
library(tidyverse)
unique_citations <- readRDS("C:/Users/matthew.grainger/Documents/Projects_in_development/landuse_effects_biodiversity/data/unique_citations.RDS")
source_comparison <- compare_sources(unique_citations, comp_type = "sources")
# Generate a source comparison upset plot.
plot_source_overlap_upset(source_comparison, decreasing = c(TRUE, TRUE))
```

### 2.2.4 Ytterligere søk etter litteratur

Artikler som er sitert av eller siteerer (engelsk: forward and backward citation chasing) de 15 benchmark-artiklene ble søkt ved hjelp av verktøyet citationchaser i R (Haddaway et al. 2022).

### 

### 2.2.5 Assembling and managing search results

MATT WRITE HERE

### 2.2.6 Screening av artikler

Vi brukte forhåndsdefinerte inklusjons-/eksklusjonskriterier for å screene kvalifiserte studier. Inkluderte studier ble de-duplisert basert på DOI og tittelmatcher ved å bruke R-pakken 'ASySD' (Hair et al. 2021). Vi beholdt den nyeste versjonen av alle versjonskontrollerte artikler (for eksempel ble publiserte versjoner av forhåndstrykk beholdt).

Etter de-duplisering ble tittel og abstrakt screening utført ved å bruke kvalifikasjonskriteriene, og alle studier klassifisert som usikre ble vurdert på fulltekststadiet. Screeningen ble gjort ved hjelp av Rayyan, med dobbel screening av en primær og flere sekundære anmeldere. Etter 50 inkluderings-/ekskluderingsbeslutninger brukte vi Rayyan-AI 5-stjerners rangering for å rangere sammendragene for vurdering. Denne algoritmen vurderer sammendrag og titler ved hjelp av naturlig språkbehandling for å identifisere poster som har et høyt potensial for inkludering (5 stjerner) eller de med et lavere potensial (1 stjerne).

Ukentlig overvåking ble utført for gruppeuenighetsrater, og kvalifikasjonskriteriene ble revurdert og justert når frekvensen oversteg 15 %. Motstridende beslutninger ble avstemt gjennom diskusjoner med hele gjennomgangsgruppen. Studier merket som usikre på hvert trinn ble vurdert på neste nivå, med de som var merket som usikre gjennomgått av hele teamet.

### 2.3 Inkluderings- og ekskluderingskriterier 

We reviewed the collated studies obtained from the searches using the criteria set below. Only studies conducted in Norway, Sweden and Finland or systematic reviews (also referred to as meta-analyses) with global, European or Fennoscandian coverage were included in the review. Only records where the full-text is written in English, Norwegian, Swedish, or Danish were considered eligible.

Studies will be eligible if they assess land use or land-use-change effects on the biodiversity, ecosystem services/functions or carbon sequestration and storage in Feno-Scandinavia. Only studies that focus on terrestrial, aquatic or coastal areas are include (i.e. studies focusing on marine systems are excluded).

Studies will also be eligible if they assess conflicts, tools or governance relating to land use and cover change its effects on biodiversity, ecosystem services and/or carbon sequestration and storage by ecosystems in Fenno-Scandinavia. The relation should be explicit in study for the record to be included.

Studies of all scales (national, regional, and local) will be considered eligible.

2.  **Eligible interventions**

Land use and/or land cover change through one or multiple drivers (see Appendix) which are anthropogenic in origin and result in one or more of the core mechanisms (change in habitat – amount; habitat composition; habitat structure; habitat – function; indirect, e.g. changed human use in recreation etc).

3.  **Eligible outcomes**

Eligible outcomes will include function, structure, diversity, abundance, behaviour, composition, or richness in any level of biological organisation (genetic, species, community, ecosystem, landscape – multiple ecosystems), as well as studies focusing on the amount of, diversity or category of ecosystem services (provisioning, regulating, supporting or cultural service and, carbon storage and sequestration).

In addition, studies within the social sciences will be included if they explicitly address conflicts, tools and governance pertaining to effects land use and land cover change on biodiversity, ecosystem services and/or carbon sequestration and storage.

4.  **Eligible types of study design**

All study designs will be considered eligible, including both quantitative and qualitative studies.

### Study validity assessment

### Data coding strategy

### Data mapping method

# Review findings

## Results of the search for literature

```{r, Prisma statement}
#| echo: false
#| message: false
#| warning: false
library(PRISMAstatement)

prisma(
  found = params$`search-results`,
  found_other = 1965,
  no_dupes = 20265,
  screened = 14808, # Needs updating
  screen_exclusions = 12144,
  full_text = 2398,
  full_text_exclusions = 0,
  qualitative = 0,
  quantitative = 0,
  width = 800, height = 800
)
```

### Sources and document types of included articles

## Review descriptive statistics

## Norway papers

```{r}
#| echo: false
#| message: false
#| warning: false
# Extract data and plot from the extraction sheet ----
## load libraies----
library(tidyverse, quietly = TRUE)
library(googlesheets4, quietly = TRUE)
library(rayyanR)
library(synthesisr)
library(openalex)
library(openalexR)
# gs4_auth()
## read in GoogleSheets----

# form <- read_sheet("https://docs.google.com/spreadsheets/d/1wwOfwz_QqwXpNxKx4Jupn336x2GttOfoXKibd-_rMuc")
# 
# ## clean names----
# form <- form |>
#   janitor::clean_names()
# ## explore----
# #names(form)
# 
# # ### select Norwegian studies----
# Nor_form <- form |>
#   filter(grepl("Norway", country))
# 
# ### selet studies that are included in the review----
# Nor_form_inc <- Nor_form |>
#   filter(does_the_study_assess_land_use_or_land_use_change_effects_on_the_biodiversity_ecosystem_services_functions_or_carbon_sequestration_and_storage_in_terrestrial_aquatic_or_coastal_areas_are_include_i_e_studies_focusing_on_marine_systems_are_excluded == "Yes" | does_the_study_assess_conflicts_tools_or_governance_relating_to_land_use_and_cover_change_its_effects_on_biodiversity_ecosystem_services_and_or_carbon_sequestration_and_storage_by_ecosystems_in_fenno_scandinavia_the_relation_should_be_explicit_in_study_for_the_record_to_be_included == "Yes")
# 
# ### Get matched details from Rayyan----
# 
# # read the Rayyan results
# 
# rayyan_biblio <- synthesisr::read_ref("data/Extraction/articles.ris")
# rayyan_biblio_cleaned <- rayyanR::parse_rayyan(rayyan_df = rayyan_biblio)
# 
# Nor_form_inc$accession_zr<-unlist(Nor_form_inc$study_id)
# 
# join_Nor_form <- Nor_form_inc |>
#   left_join(rayyan_biblio_cleaned, join_by("accession_zr"))
# 
# # join_Nor_form |> view()
# 
# join_Nor_form |>
#   filter(is.na(join_Nor_form$doi)) |>
#   select(study_id, study_title)
# 
# #### find missing doi's by title
# which(is.na(join_Nor_form$doi))
# #11, 47,52,60,61,63,74,75,125,158
# 
# works_search <- oa_fetch(
#   entity = "works",
#   title.search = c("Roads forestry wolves"),
#   verbose = TRUE
# )
# works_search$doi
# # "https://doi.org/10.1002/ecs2.3358"
# 
# join_Nor_form[11, ]$doi <- "10.3233/hsm-1986-6105"
# #join_Nor_form[35, ]$doi <- "10.1002/ecs2.3358"
# join_Nor_form[47, ]$doi <- "10.1017/s0024282996000424"
# join_Nor_form[52, ]$doi <- "10.1127/nova.hedwigia/66/1998/283"
# join_Nor_form[60, ]$doi <- NA
# join_Nor_form[61, ]$doi <- "10.14430/arctic829"
# join_Nor_form[63, ]$doi<-"10.1007/s002670010195"
# join_Nor_form[c(74,75,125,158), ]$doi<-NA
# 
# # get openAlexR data
# 
# 
# doi_list <- strsplit(join_Nor_form$doi, split = " ")
# doi_list <- sapply(doi_list, "[[", 1)
# 
# # # oa_fetch(
# # #   doi = c(doi_list),
# # #   entity = "works",
# # #   verbose = TRUE
# # # ) %>%
# # #   show_works() %>%
# # #   knitr::kable()
# 
# bib_ls <- list(
#   doi = c(doi_list),
#   entity = "works"
# )
# 
# # # oa_fetch(
# # #   # identifier = c("W2741809807", "W2755950973"),
# # #   doi = c("10.1016/j.joi.2017.08.007", "https://doi.org/10.1093/bioinformatics/btab727"),
# # #   entity = "works",
# # #   verbose = TRUE
# # # ) %>%
# # #   show_works() %>%
# # #   knitr::kable()
# # #
# # #
# # #
# nor_bib <- do.call(oa_fetch, bib_ls) %>%
#   oa2bibliometrix()
# saveRDS(nor_bib, "data/cache_data/nor_bib.RDS")
# saveRDS(join_Nor_form, "data/cache_data/join_Nor_form.RDS")
nor_bib <- readRDS("C:/Users/matthew.grainger/Documents/Projects_in_development/landuse_effects_biodiversity/data/cache_data/nor_bib.RDS")
join_Nor_form<-readRDS("C:/Users/matthew.grainger/Documents/Projects_in_development/landuse_effects_biodiversity/data/cache_data/join_Nor_form.RDS")
```

There were `r nrow(nor_bib)` articles included that were conducted in Norway.

```{r openAlex topics/concepts}
#| echo: false
#| message: false
#| warning: false
#| fig-cap: "OpenAlex topics weighted by topic score"

topics_aggregated <- map_df(nor_bib$topics, ~ .x %>%
  filter(name == "topic") |> # Filter to include only topics
  select(display_name, score)) |> # Select relevant columns
  group_by(display_name) |> # Group by topic name
  summarise(
    total_score = sum(score), # Sum scores for each topic
    .groups = "drop"
  ) # Drop grouping

# Create a bar plot of the weighted frequencies
topics_aggregated |> 
  top_n(10) |> 
ggplot(aes(x = reorder(display_name, total_score), y = total_score)) +
  geom_bar(stat = "identity", fill = "blue") +
  labs(title = "Weighted Frequency of Topics by Total Score",
       x = "Topic",
       y = "Total Score (Weighted Frequency)") +
coord_flip()+
  ggthemes::theme_solarized()
```

## Chronological distribution and document contents of included articles

```{r publication year}
#| echo: false
#| message: false
#| warning: false
#| fig-cap: "Cumulative sum of Norwegian publications per year"

nor_bib |> 
  mutate(year=year(publication_date)) |> 
  group_by(year) |> 
  tally() |> 
  mutate(csum=cumsum(n)) |> 
  ggplot(aes(year,csum)) +
  geom_point(colour="blue")+
  labs(x="Publication Year", y="Cumulative sum of publications")+
  ggthemes::theme_solarized()
```

### What proportion of the research is based on experimental vs observational?

```{r research_type}
#| echo: false
#| message: false
#| warning: false

join_Nor_form |> 
  select(study_id ,study_title, research_type) |> 
  group_by(research_type) |>
  tally() |> 
  drop_na() |> 
  ggplot(aes(reorder(research_type, n),n,fill=research_type))+
  geom_histogram(stat="identity")+
  ggthemes::theme_solarized()+
  coord_flip()+
  theme(legend.position = "Null")+
  labs(x="", y="antall publikasjoner")
```


```{r study_design}
#| echo: false
#| message: false
#| warning: false

join_Nor_form |> 
  filter(grepl("observational",tolower(research_type))) |> 
  select(study_id ,study_title,study_design_observational_studies ) |> 
  group_by(study_design_observational_studies) |> 
  tally() |> 
  drop_na() |> 
  ggplot(aes(reorder(study_design_observational_studies,n),n,fill=study_design_observational_studies))+
  geom_histogram(stat="identity")+
  ggthemes::theme_solarized()+
  coord_flip()+
  theme(legend.position = "Null")+
  labs(x="", y="antall publikasjoner")
```

###  How is research spread across the major ecosystem types/realms

```{r ecosystems }
#| echo: false
#| message: false
#| warning: false
join_Nor_form |> 
  group_by(ecosystem_type_main) |>
  mutate(ecosystems_main = strsplit(ecosystem_type_main, ","))  |> 
  unnest(ecosystems_main)  |> 
  group_by(ecosystems_main) |> 
  tally() |> 
  drop_na() |> 
  ggplot(aes(reorder(ecosystems_main, n),n,fill=ecosystems_main))+
  geom_histogram(stat="identity")+
  ggthemes::theme_solarized()+
  coord_flip()+
  theme(legend.position = "Null")+
  labs(x="", y="antall publikasjoner")
```

### How is research spread across the disciplines

```{r discipline}
#| echo: false
#| message: false
#| warning: false
join_Nor_form |> 
  group_by(study_area_discipline) |> 
  tally() |> 
  drop_na() |> 
  ggplot(aes(reorder(study_area_discipline, n),n,fill=study_area_discipline))+
  geom_histogram(stat="identity")+
  ggthemes::theme_solarized()+
  coord_flip()+
  theme(legend.position = "Null")+
  labs(x="", y="antall publikasjoner")

```

### What are the dominant types of land use that are investigated?

```{r landuse}
#| echo: false
#| message: false
#| warning: false

join_Nor_form |> 
  group_by(x23) |>
  mutate(land_use = strsplit(x23, ","))  |> 
  unnest(land_use)  |> 
  group_by(land_use) |> 
  tally() |> 
  drop_na() |> 
  ggplot(aes(reorder(land_use, n),n,fill=land_use))+
  geom_histogram(stat="identity")+
  ggthemes::theme_solarized()+
  coord_flip()+
  theme(legend.position = "Null")+
  labs(x="", y="antall publikasjoner")

```

### Geographical distribution of included observations

```{r County distribution}
#| echo: false
#| message: false
#| warning: false
#| fig-cap: "Norwegian counties where research was undertaken"
my_list<-strsplit(join_Nor_form$county_name_of_norwegian_county, ",")

# Function to replace specific problematic characters
replace_problematic_chars <- function(x) {
  # Replacing specific problematic unicode sequence if visible in the string
  x <- gsub("\xc3\x98", "O", x, fixed = TRUE)  # Replacing 'Ø' which sometimes appears as '\xc3\x98' in UTF-8

  return(x)
}

# Apply this function to each element in the list
my_list <- lapply(my_list, function(x) {
  if (is.character(x)) {
    sapply(x, replace_problematic_chars, USE.NAMES = FALSE)
  } else {
    x
  }
})

# Flatten the list
flattened <- unlist(my_list)

# Remove NA and clean up
flattened <- na.omit(flattened)
flattened <- trimws(flattened)

# Create a dataframe
df <- data.frame(Name = flattened, stringsAsFactors = FALSE)

# Print the dataframe
#print(df)

df |> 
  group_by(Name) |> 
  tally() |> 
  ggplot(aes(reorder(Name, n),n)) + 
  geom_histogram(stat="identity", fill="blue")+
  coord_flip()+
  labs(x="", y="Antall publikasjoner")+
  ggthemes::theme_solarized()

```

```{r topic model}
#| echo: false
#| message: false
#| warning: false

library(ldatuning)
library(topicmodels)
library(tm)
library(tidytext)

jn_dtm<-join_Nor_form |> 
  select(study_id, title, abstract, year)

#jn_dtm$study_id<-unlist(jn_dtm$study_id)

jn_dtm<-jn_dtm |> 
  mutate(title_abs=paste0(title,abstract)) |>
  unnest_tokens(word,title_abs) |> 
  rowid_to_column()
jn_dtm<-jn_dtm |> 
  mutate(word=removeNumbers(word))

jn_dtm<-jn_dtm |> 
  filter(word !="")

jn_test<-jn_dtm |> 
distinct(study_id,.keep_all=TRUE)

jn_dtm<-jn_dtm|> 
  group_by(study_id) |> 
  count(study_id, word, sort = TRUE)
data(stop_words)
jn_dtm<-jn_dtm |> 
  anti_join(stop_words)



jn_dtm<-
  jn_dtm |> 
  cast_dtm(study_id, word, n)
```

```{r}
#| echo: false
#| message: false
#| warning: false
# number of topics
library(ldatuning)
result <- FindTopicsNumber(
  jn_dtm,
  topics = seq(from = 2, to = 15, by = 1),
  metrics = c("Griffiths2004", "CaoJuan2009", "Arun2010", "Deveaud2014"),
  method = "Gibbs",
  control = list(seed = 77),
  mc.cores = 2L,
  verbose = TRUE
)

FindTopicsNumber_plot(result)

saveRDS(result, "data/cache_data/result.RDS")
```

```{r}
#| echo: false
#| message: false
#| warning: false
jn_lda <- LDA(jn_dtm, k = 6, control = list(seed = 1234))
saveRDS(jn_lda, "data/cache_data/jn_lda.RDS")

```

```{r}
#| echo: false
#| message: false
#| warning: false
jn_topics <- tidy(jn_lda, matrix = "beta")
top_terms <- jn_topics %>%
  group_by(topic) %>%
  slice_max(beta, n = 20) %>% 
  ungroup() %>%
  arrange(topic, -beta)

p1<-top_terms %>%
  mutate(term = reorder_within(term, beta, topic)) %>%
  ggplot(aes(beta, term, fill = factor(topic))) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~ topic, scales = "free") +
  scale_y_reordered()+
ggthemes::theme_solarized()

p1

```

```{r}
#| echo: false
#| message: false
#| warning: false
library(stm)
library(wordcloud2)

as.data.frame(terms(jn_lda, 10))

data.frame(Topic = topics(jn_lda))

lda.topics<- 
data.frame(jn_test, Topic = topics(jn_lda)) |> 
  add_count(title, Topic) |> 
  group_by(title) |>  
  mutate(Share = n/sum(n)) |> 
  ungroup() |>  
  mutate(Topic = paste0("Topic ", sprintf("%02d", Topic)))  |>  
  mutate(Article = as_factor(title))

ggplot(lda.topics, aes(title, Share, color = Topic, fill = Topic)) + geom_bar(stat="identity") + ggtitle("LDA topics in Norwegian LULCC peer-reviewed studies") + xlab("") + ylab("Share of topics [%]") + theme(axis.text.x = element_text(angle = 45, hjust = 1))


```

## Mapping the effects of land use and land cover change on biodiversity, carbon and conflicts

```{r keyword co-occurrence}
#| echo: false
#| message: false
#| warning: false
library(bibliometrix)
# Create keyword co-occurrences network

NetMatrix <- biblioNetwork(nor_bib, analysis = "co-occurrences", network = "keywords", sep = ";")

# Plot the network
net=networkPlot(NetMatrix, normalize="association", weighted=T, n = 30, Title = "Keyword Co-occurrences", type = "fruchterman", size=T,edgesize = 5,labelsize=0.7)
```

```{r}
#| echo: false
#| message: false
#| warning: false
# nor_bib=metaTagExtraction(nor_bib,"CR_SO",sep=";")
# 
# NetMatrix <- biblioNetwork(M, analysis = "co-citation", network = "sources", sep = ";")
# net=networkPlot(NetMatrix, n = 50, Title = "Co-Citation Network", type = "auto", size.cex=TRUE, size=15, remove.multiple=FALSE, labelsize=1,edgesize = 10, edges.min=5)
```

```{r}
#| echo: false
#| message: false
#| warning: false
# results<-biblioAnalysis(nor_bib)
# histResults <- histNetwork(nor_bib, sep = ";")
```


# Limitations of the map

# Limitations of the evidence base

# Conclusions

## Implications for Research

## Implications for management/practice
